{% extends 'base.html' %}

{% load widget_tweaks %}
{% load static %}
{% block content %}

<div class="col-11 mx-auto">
    <div class="container-fluid">
        <div class="row">
    <div class="row mx-auto my-auto justify-content-center">
        <div id="adsCarousel" class="carousel slide" data-ride="carousel" data-interval="9000">
            <div class="carousel-inner" role="listbox">
                {% for advertisement in advertisements %}
                <div class="carousel-item {% if forloop.counter0 == 0 %}active{% endif %}"
                     style="text-align: center;">
                <div class="col-md-4">
                   <img src="/media/{{advertisement.image}}" class="mx-auto d-bloc"
                         alt="{{advertisement.header}}"
                         onclick="check_ad_count({{advertisement.pk}}); location.href='show_advertisement/{{advertisement.header}}';"
                         style="cursor:pointer; height: 140px; max-width: 100%">
                </div>
                </div>
                {% endfor %}
            </div>

            <button class="carousel-control-prev" type="button" data-bs-target="#adsCarousel"
                    data-bs-slide="prev" style="left: -5%;">
                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                <span class="visually-hidden">Previous</span>
            </button>
            <button class="carousel-control-next" type="button" data-bs-target="#adsCarousel"
                    data-bs-slide="next" style="right: -5%">
                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                <span class="visually-hidden">Next</span>
            </button>
        </div>
    </div>
    </div>
</div>


<div id="event-page" class="col-lg-9 col-md-12 mx-auto">
    <form id="form-events" class="row p-3" action="{% url 'EventsApp:home' %}" method="get">
        <div class="col mb-2" id="events_types_select" style="flex-grow: 1;">
            <select id="events_types" class="form-control form-select select2" multiple name="events_types"
                    style="height:26px; flex-grow: 1;">
                <option value="Camp" {% if 'Camp' in selected_events_types %}selected{% endif %}>Camp</option>
                <option value="Charity" {% if 'Charity' in selected_events_types %}selected{% endif %}>Charity</option>
                <option value="Conditioning" {% if 'Conditioning' in selected_events_types %}selected{% endif %}>Conditioning</option>
                <option value="Development" {% if 'Development' in selected_events_types %}selected{% endif %}>Development</option>
                <option value="Game/Session" {% if 'Game/Session' in selected_events_types %}selected{% endif %}>Game/Session</option>
                <option value="Online" {% if 'Online' in selected_events_types %}selected{% endif %}>Online</option>
                <option value="Registration" {% if 'Registration' in selected_events_types %}selected{% endif %}>Registration</option>
                <option value="Social" {% if 'Social' in selected_events_types %}selected{% endif %}>Social</option>
                <option value="Tournament" {% if 'Tournament' in selected_events_types %}selected{% endif %}>Tournament</option>
            </select>
        </div>
        <div id="sports_select" class="col mb-2" style="flex-grow: 1;">
            <select id="sport_types" class="form-control form-select select2sport" style="height:26px; flex-grow: 1;" name="sports">
                <option value="" selected="selected">Select Sport</option>
                {% for sports in sports_list %}
                <option value="{{sports.sports_type_text}}" {% if sports.sports_type_text == selected_sports %}selected{% endif %}>{{sports.sports_type_text}}
                </option>
                {% endfor %}
            </select>
        </div>
        <div class="col mb-2 mb-2">
            <input class="form-control select-style datesingle" onfocus="(this.type='date')"
                   onblur="this.type='text'" value="{{selected_date}}" placeholder="Select Date" name="date_range"/>
        </div>
        <div id="venues_select" class="col mb-2 mb-2" style="flex-grow: 1;">
            {% if user.is_authenticated %}
            <select id="venue_types" class="form-control form-select select2venue" style="height:26px; flex-grow: 1;" name="venues">
                <option value="" selected="selected">Select Venue</option>
                {% for venues in venues_list %}
                <option value="{{venues.vm_name}}" {% if venues.vm_name == selected_venues %}selected{% endif %}>
                    {{venues.vm_name}}
                </option>
                {% endfor %}
            </select>
            {% else %}
            <select id="city_types" class="form-control form-select select2city" style="height:26px; flex-grow: 1;" name="cities">
                <option value="" selected="selected">Select City</option>
                {% for city in cities_list %}
                <option value="{{city.vm_venuecity}}" {% if city.vm_venuecity == selected_cities %}selected{% endif %}>
                    {{city.vm_venuecity}}
                </option>
                {% endfor %}
            </select>
            {% endif %}
        </div>
        <div class="row-12 text-center">
            <button type="submit" class="btn btn-primary mr-2 m-2" style="width: 90px;">
                Search
            </button>
            <a href="{% url 'EventsApp:home' %}" class="btn btn-primary ml-2 m-2" style="width: 90px;">
                Clear
            </a>
        </div>
    </form>
</div>

{% if user.is_authenticated %}

    <div class="col-11 mx-auto">
        <div class="container-fluid">
            <div class="row p-3">
                <h5>Recommended Drop In Events</h5>
                <hr class="my-2">
                <div id="carousel_recommended_drop_in_eventList" class="carousel slide" data-ride="carousel"
                     data-interval="false"
                     data-touch="true">
                    <div class="carousel-inner" role="listbox">
                        {% for event in recommended_drop_in %}
                        <div class="carousel-item {% if forloop.counter0 == 0 %}active{% endif %}"
                             style="text-align: center;">
                            <div class="col-md-4">
                                <div class="event-card card"
                                     onclick="location.href='event_details/{{event.pk}}/{% if event.datetimes %}{{event.datetimes}}{% elif event.current_datetimes %}{{event.current_datetimes}}{% endif %}/'"
                                     style="cursor:pointer">
                                    <img src="{{event.sport_logo}}" class="img-fluid"
                                         alt="..." style="cursor:pointer"
                                         onclick="location.href='event_details/{{event.pk}}/{% if event.datetimes %}{{event.datetimes}}{% elif event.current_datetimes %}{{event.current_datetimes}}{% endif %}/'">
                                    <div class="card-body">
                                        <h5 class="card-title">{{event.sport_type}}</h5>
                                        <h6 class="card-subtitle mb-2 text-muted">
                                            {% if event.event_title %}
                                            {{event.event_title}} :
                                            {% endif %}
                                            {% if event.event_type %}
                                            {{event.event_type}}
                                            {% endif %}
                                        </h6>
                                        <p class="card-text">{{event.venue}}, {{event.city}}, {{event.province}}</p>
                                        {% if event.datetimes %}
                                        <p class="text-dark text-start eventdatetime">{{event.datetimes}}</p>
                                        {% elif event.current_datetimes %}
                                        <p class="text-dark text-start eventdatetime">{{event.current_datetimes}}</p>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    <button class="carousel-control-prev" type="button"
                            data-bs-target="#carousel_recommended_drop_in_eventList"
                            data-bs-slide="prev" style="left: -5%;">
                        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                        <span class="visually-hidden">Previous</span>
                    </button>
                    <button class="carousel-control-next" type="button"
                            data-bs-target="#carousel_recommended_drop_in_eventList"
                            data-bs-slide="next" style="right: -5%">
                        <span class="carousel-control-next-icon" aria-hidden="true"></span>
                        <span class="visually-hidden">Next</span>
                    </button>
                </div>
            </div>
        </div>
        <div class="container-fluid">
            <div class="row p-3">
                <h5>Recommended Registration Programs</h5>
                <hr class="my-2">
                <div id="carousel_recommended_registration_eventList" class="carousel slide" data-ride="carousel"
                     data-interval="false"
                     data-touch="true">
                    <div class="carousel-inneR" role="listbox">
                        {% for event in recommended_registrationList %}
                        <div class="carousel-item {% if forloop.counter0 == 0 %}active{% endif %}"
                             style="text-align: center;">
                            <div class="col-md-4">
                                <div class="event-card card"
                                     onclick="location.href='event_details/{{event.pk}}/{% if event.datetimes %}{{event.datetimes}}{% elif event.current_datetimes %}{{event.current_datetimes}}{% endif %}/'"
                                     style="cursor:pointer">
                                    <img src="{{event.sport_logo}}" class="img-fluid"
                                         alt="..." style="cursor:pointer"
                                         onclick="location.href='event_details/{{event.pk}}/{% if event.datetimes %}{{event.datetimes}}{% elif event.current_datetimes %}{{event.current_datetimes}}{% endif %}/'">
                                    <div class="card-body">
                                        <h5 class="card-title">{{event.sport_type}}</h5>
                                        <h6 class="card-subtitle mb-2 text-muted">
                                            {% if event.event_title %}
                                            {{event.event_title}} :
                                            {% endif %}
                                            {% if event.event_type %}
                                            {{event.event_type}}
                                            {% endif %}
                                        </h6>
                                        <p class="card-text">{{event.venue}}, {{event.city}}, {{event.province}}</p>
                                        {% if event.datetimes %}
                                        <p class="text-dark text-start eventdatetime">{{event.datetimes}}</p>
                                        {% elif event.current_datetimes %}
                                        <p class="text-dark text-start eventdatetime">{{event.current_datetimes}}</p>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    <button class="carousel-control-prev" type="button"
                            data-bs-target="#carousel_recommended_registration_eventList"
                            data-bs-slide="prev" style="left: -5%;">
                        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                        <span class="visually-hidden">Previous</span>
                    </button>
                    <button class="carousel-control-next" type="button"
                            data-bs-target="#carousel_recommended_registration_eventList"
                            data-bs-slide="next" style="right: -5%">
                        <span class="carousel-control-next-icon" aria-hidden="true"></span>
                        <span class="visually-hidden">Next</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

{% else %}

    <div class="col-11 mx-auto">
        <div class="container-fluid">
            <div class="row p-3">
                <h5>All Drop In Events</h5>
                <hr class="my-2">
                <div id="carouseldrop_in_eventList" class="carousel slide" data-ride="carousel" data-interval="false"
                     data-touch="true">
                    <div class="carousel-inner" role="listbox">
                        {% for event in drop_in_eventList %}
                        <div class="carousel-item {% if forloop.counter0 == 0 %}active{% endif %}"
                             style="text-align: center;">
                            <div class="col-md-4">
                                <div class="event-card card"
                                     onclick="location.href='event_details/{{event.pk}}/{% if event.datetimes %}{{event.datetimes}}{% elif event.current_datetimes %}{{event.current_datetimes}}{% endif %}/'"
                                     style="cursor:pointer">
                                    <img src="{{event.sport_logo}}" class="img-fluid"
                                         alt="..." style="cursor:pointer"
                                         onclick="location.href='event_details/{{event.pk}}/{% if event.datetimes %}{{event.datetimes}}{% elif event.current_datetimes %}{{event.current_datetimes}}{% endif %}/'">
                                    <div class="card-body">
                                        <h5 class="card-title">{{event.sport_type}}</h5>
                                        <h6 class="card-subtitle mb-2 text-muted">
                                            {% if event.event_title %}
                                            {{event.event_title}} :
                                            {% endif %}
                                            {% if event.event_type %}
                                            {{event.event_type}}
                                            {% endif %}
                                        </h6>
                                        <p class="card-text">{{event.venue}}, {{event.city}}, {{event.province}}</p>
                                        {% if event.datetimes %}
                                        <p class="text-dark text-start eventdatetime">{{event.datetimes}}</p>
                                        {% elif event.current_datetimes %}
                                        <p class="text-dark text-start eventdatetime">{{event.current_datetimes}}</p>
                                        {% endif %}
                                    </div>
                                </div>

                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    <button class="carousel-control-prev" type="button" data-bs-target="#carouseldrop_in_eventList"
                            data-bs-slide="prev" style="left: -5%;">
                        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                        <span class="visually-hidden">Previous</span>
                    </button>
                    <button class="carousel-control-next" type="button" data-bs-target="#carouseldrop_in_eventList"
                            data-bs-slide="next" style="right: -5%">
                        <span class="carousel-control-next-icon" aria-hidden="true"></span>
                        <span class="visually-hidden">Next</span>
                    </button>
                </div>

            </div>
        </div>
        <div class="container-fluid">
            <div class="row p-3">
                <h5>All Registration Programs</h5>
                <hr class="my-2">
                <div id="carouselregistration_eventList" class="carousel slide" data-ride="carousel"
                     data-interval="false"
                     data-touch="true">
                    <div class="carousel-inner" role="listbox">
                        {% for event in registrationList %}
                        <div class="carousel-item {% if forloop.counter0 == 0 %}active{% endif %}"
                             style="text-align: center;">
                            <div class="col-md-4">
                                <div class="event-card card"
                                     onclick="location.href='event_details/{{event.pk}}/{% if event.datetimes %}{{event.datetimes}}{% elif event.current_datetimes %}{{event.current_datetimes}}{% endif %}/'"
                                     style="cursor:pointer">
                                    <img src="{{event.sport_logo}}" class="img-fluid"
                                         alt="..." style="cursor:pointer"
                                         onclick="location.href='event_details/{{event.pk}}/{% if event.datetimes %}{{event.datetimes}}{% elif event.current_datetimes %}{{event.current_datetimes}}{% endif %}/'">
                                    <div class="card-body">
                                        <h5 class="card-title">{{event.sport_type}}</h5>
                                        <h6 class="card-subtitle mb-2 text-muted">
                                            {% if event.event_title %}
                                            {{event.event_title}} :
                                            {% endif %}
                                            {% if event.event_type %}
                                            {{event.event_type}}
                                            {% endif %}
                                        </h6>
                                        <p class="card-text">{{event.venue}}, {{event.city}}, {{event.province}}</p>
                                        {% if event.datetimes %}
                                        <p class="text-dark text-start eventdatetime">{{event.datetimes}}</p>
                                        {% elif event.current_datetimes %}
                                        <p class="text-dark text-start eventdatetime">{{event.current_datetimes}}</p>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    <button class="carousel-control-prev" type="button" data-bs-target="#carouselregistration_eventList"
                            data-bs-slide="prev" style="left: -5%;">
                        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                        <span class="visually-hidden">Previous</span>
                    </button>
                    <button class="carousel-control-next" type="button" data-bs-target="#carouselregistration_eventList"
                            data-bs-slide="next" style="right: -5%">
                        <span class="carousel-control-next-icon" aria-hidden="true"></span>
                        <span class="visually-hidden">Next</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

{% endif %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.3.0/js/bootstrap-datepicker.js"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.8.0/css/bootstrap-datepicker.css"
      rel="stylesheet"/>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.touchswipe/1.6.19/jquery.touchSwipe.min.js"
        integrity="sha512-YYiD5ZhmJ0GCdJvx6Xe6HzHqHvMpJEPomXwPbsgcpMFPW+mQEeVBU6l9n+2Y+naq+CLbujk91vHyN18q6/RSYw=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script>

    function check_ad_count(pk) {
        $.ajax({
            type: "GET",
            url: '{% url "EventsApp:update_hit_count" %}',
            data: {
                'ad_pk': pk,
            },
            success: function (data) {
                console.log("Done");
            }
        });
    }

    $(".carousel").swipe({
        swipe: function (event, direction, distance, duration, fingerCount, fingerData) {
            if (direction == 'left') $(this).carousel('next');
            if (direction == 'right') $(this).carousel('prev');
        },
        allowPageScroll: "vertical"
    });


    $(document).ready(function () {
        let myWidth = $(window).width();
        let myHeight = window.innerHeight;
        callFormSizeChange(myWidth, myHeight);
        $(window).resize(function () {
            var nw = $(window).width();
            let myHeight = window.innerHeight;
            myWidth = nw;
            callFormSizeChange(myWidth, myHeight);
        });

        $('.select2').select2({
            placeholder: "Select Event Type",
            allowClear: true
        });
        $('.select2venue').select2({
            placeholder: "Select Venue",
            allowClear: true
        });
        $('.select2sport').select2({
            placeholder: "Select Sport",
            allowClear: true
        });
        $('.select2city').select2({
            placeholder: "Select City",
            allowClear: true
        });
        var parent = document.getElementById('events_types_select')
        parent.querySelectorAll('span')[3].classList.add('ps-2');
        parent.querySelectorAll('span')[2].style.paddingBottom = '2px';
        parent.querySelectorAll('span')[2].style.borderColor = '#000000';
        var parent = document.getElementById('sports_select')
        parent.querySelectorAll('span')[3].classList.add('ps-2');
        parent.querySelectorAll('span')[2].style.paddingBottom = '4px';
        parent.querySelectorAll('span')[2].style.borderColor = '#000000';
        var parent = document.getElementById('venues_select')
        parent.querySelectorAll('span')[3].classList.add('ps-2');
        parent.querySelectorAll('span')[2].style.paddingBottom = '4px';
        parent.querySelectorAll('span')[2].style.borderColor = '#000000';

        let para = document.getElementsByClassName("eventdatetime");
        for (let i = 0; i < para.length; i++) {
            let pval = para[i].innerHTML.split("from");
            para[i].innerHTML = "";
            para[i].innerHTML = pval[0] + "<br>" + pval[1];
        }

        $('.datesingle').datepicker({orientation: 'top', format: 'yyyy-mm-dd',});


    });

    let carousels=document.querySelectorAll(".carousel");
    carousels.forEach((carousel)=>{
        let items = carousel.querySelectorAll('.carousel-item');
        create(items);
    })


    function create(items) {
        items.forEach((el) => {
            const minPerSlide = 3
            let next = el.nextElementSibling
            for (var i = 1; i < minPerSlide; i++) {
                if (!next) {
                    // wrap carousel by using first child
                    next = items[0]
                }
                let cloneChild = next.cloneNode(true)
                el.appendChild(cloneChild.children[0])
                next = next.nextElementSibling
            }
        })
    }
$(document).ready(function(){
  $('#adsCarousel').carousel({interval: false});
  $('#adsCarousel').carousel('pause');
});
    function callFormSizeChange(myWidth, myHeight) {
        if (myWidth >= 768) {
            if (document.getElementById("events_types")) {
                document.getElementById("events_types").style.width = "100%";
            }
            if (document.getElementById("sport_types")) {
                document.getElementById("sport_types").style.width = "100%";
            }
            if (document.getElementById("venue_types")) {
                document.getElementById("venue_types").style.width = "100%";
            }
            if (document.getElementById("city_types")) {
                document.getElementById("city_types").style.width = "100%";
            }
            // document.getElementById("logo-image").style.width = "200px";
            if (document.getElementById('form-events')) {
                document.getElementById("form-events").classList.remove('col-12');
                document.getElementById("form-events").classList.add('row');
            }
            if (document.getElementById('event-page')) {
                document.getElementById("event-page").classList.remove('col-12');
                document.getElementById("event-page").classList.add('col-9');
            }

        } else {
            if (document.getElementById("events_types")) {
                document.getElementById("events_types").style.width = "100%";
            }
            if (document.getElementById("sport_types")) {
                document.getElementById("sport_types").style.width = "100%";
            }
            if (document.getElementById("city_types")) {
                document.getElementById("city_types").style.width = "100%";
            }
            if (document.getElementById("venue_types")) {
                document.getElementById("venue_types").style.width = "100%";
            }
            // document.getElementById("logo-image").style.width = "150px";
            if (document.getElementById('form-events')) {
                document.getElementById("form-events").classList.remove('row');
                document.getElementById("form-events").classList.add('col-12');
            }
            if (document.getElementById('event-page')) {
                document.getElementById("event-page").classList.remove('col-9');
                document.getElementById("event-page").classList.add('col-12');
            }

        }
    }

</script>

<style>

    .cards-wrapper {
        display: flex;
        justify-content: center;
    }

    .card img {
        max-width: 100%;
        max-height: 100%;
    }

    .card {
        margin: 0 0.5em;
        box-shadow: 2px 6px 8px 0 rgba(22, 22, 26, 0.18);
        border: none;
        border-radius: 0;
    }

    .carousel-inner {
        padding: 1em;
    }

    .carousel-control-prev,
    .carousel-control-next {
        background-color: #e1e1e1;
        width: 5vh;
        height: 5vh;
        border-radius: 50%;
        top: 50%;
        transform: translateY(-50%);
    }

    @media (min-width: 768px) {
        .card img {
            height: 11em;
        }

    }

    .select2-search__field {
        height: 26px !important;
    }

    .select2sport-search__field {
        height: 26px !important;
    }

    .select2venue-search__field {
        height: 26px !important;
    }

    .select2city-search__field {
        height: 26px !important;
    }

    .select2-selection__placeholder {
        color: black !important;
    }

    .select2-container .select2-selection--single {
        height: initial !important;
    }

    .card:hover {
        box-shadow: 5px 6px 6px 2px #e9ecef;
        transform: scale(1.05);
        transition: all .4s ease;
        -webkit-transition: all .4s ease;
    }

    .select-style {
        border: 1px solid #000 !important;
        height: 37px;
        color: black;
        border-radius: 4px !important;
        font-family: inherit !important;
        font-size: 17px !important;
    }

    input[type=text]::placeholder {
        color: #000;
    }

    textarea::placeholder {
        color: #000;
    }

    .select2-container {
        height: 37px;
    }


    .select2-container--default .select2-selection--single .select2-selection__arrow {
        height: 37px;
    }

    .select2-container--default .select2-selection--single .select2-selection__placeholder {
        font-size: 17px;
    }

    .select2-selection__rendered {
        height: 31px;
        margin-left: 5px;
    }

    .select2-container--default .select2-selection--single .select2-selection__rendered {
        line-height: 31px;
    }

    .select2-selection--multiple {
        height: 37px;
    }

    .select2-container .select2-search--inline .select2-search__field {
        font-size: 17px;
        font-family: inherit;
        color: black;
    }
   .datesingle::placeholder { color: black; text-align: left}

    .carousel-inner .carousel-item.active,
     .carousel-inner .carousel-item-next,
     .carousel-inner .carousel-item-prev {
        display: flex;
    }
    @media (max-width: 767px) {
		.carousel-inner .carousel-item > div {
			display: none;
		}
		.carousel-inner .carousel-item > div:first-child {
			display: block;
		}
	}

	.carousel-inner .carousel-item.active,
	.carousel-inner .carousel-item-next,
	.carousel-inner .carousel-item-prev {
		display: flex;
        justify-content: center;
	}

</style>

{% endblock %}